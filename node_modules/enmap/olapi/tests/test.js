const OLAPI = require('../index.js');
const fs = require('fs-nextra');
const { inspect } = require('util');

const api = new OLAPI({});

// File Demo Setup
const datafile = fs.createReadStream('./test.pdf');
const dmConfig = fs.createReadStream('./test.ol-datamapper');

// Readline module test
const readline = require('readline');

const rl = readline.createInterface({
  input: process.stdin,
  output: process.stdout,
});

rl.on('line', async (input) => {
  try {
    let evaled = eval(input);
    if (evaled && evaled.constructor.name === 'Promise')
      evaled = await evaled;
    if (typeof evaled !== 'string')
      evaled = inspect(evaled);
    console.log(evaled);
  } catch (err) {
    console.log(`ERROR: \n${err}`);
  }
});

process.on('uncaughtException', (err) => {
  const errorMsg = err.stack.replace(new RegExp(`${__dirname}\/`, 'g'), './');
  console.error('Uncaught Exception: ', errorMsg);
});

process.on('unhandledRejection', err => console.error('Uncaught Promise Error: ', err));
